<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>The Wedding of Tiyah & Ubed</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@400;600;700&family=Poppins:wght@300;400;500;600&display=swap');
html, body { margin:0; padding:0; width:100%; overflow-x:hidden; font-family:'Cambria', sans-serif; scroll-behavior:smooth; }
.font-dancing { font-family:'Dancing Script', cursive; }
.bg-gradient-wedding { background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 50%, #f3e8ff 100%); }
.animate-fade-in { animation: fadeIn 1s ease-in; }
@keyframes fadeIn { from {opacity:0; transform:translateY(20px);} to {opacity:1; transform:translateY(0);} }
.petal { position:absolute; width:10px; height:10px; background:#f472b6; border-radius:50%; animation:fall 8s linear infinite; }
@keyframes fall { 0% { transform:translateY(-100px) rotate(0deg); opacity:1; } 100% { transform:translateY(100vh) rotate(360deg); opacity:0; } }
.music-note { position:fixed; bottom:20px; right:20px; z-index:1000; }
.mempelai-bg { background: url('mempelai-bg.jpg') center/cover no-repeat; background-attachment:fixed; position:relative; overflow:hidden; }
.mempelai-bg::before { content:''; position:absolute; inset:0; background:rgba(0,0,0,0.3); }
.mempelai-content { position:relative; z-index:10; }

/* Chat / komentar styling */
.comment-bubble { background:#fff; padding:10px 14px; border-radius:16px; box-shadow:0 2px 5px rgba(0,0,0,0.1); margin-bottom:8px; position:relative; }
.comment-author { font-weight:bold; color:#ec4899; margin-bottom:2px; }
.comment-msg { margin-bottom:2px; white-space:pre-line; }
.comment-time { font-size:0.7rem; color:#9ca3af; margin-top:4px; }
.reply-box { margin-left:1.25rem; border-left:2px solid #fbcfe8; padding-left:1rem; margin-top:0.5rem; background:#fafafa; border-radius:8px; padding-top:8px; padding-bottom:8px; }

/* Toast animation */
#toastContainer{position:fixed;bottom:20px;right:20px;z-index:9999;display:flex;flex-direction:column;gap:10px;}
.toast{padding:10px 18px;border-radius:8px;color:white;font-size:0.9rem;box-shadow:0 2px 8px rgba(0,0,0,0.2);animation:fadeInOut 3s forwards;}
@keyframes fadeInOut{
  0%{opacity:0;transform:translateY(20px);}
  10%{opacity:1;transform:translateY(0);}
  90%{opacity:1;}
  100%{opacity:0;transform:translateY(20px);}
}

@media (max-width: 640px){
  h1,h2,h3{line-height:1.2;}
  .font-dancing{font-size:clamp(1.5rem,6vw,3rem);}
  section,footer{padding-left:1rem;padding-right:1rem;}
  .max-w-4xl, .max-w-md { width:100%; }
}
</style>
</head>
<body class="bg-gradient-wedding min-h-screen">

<div id="petals"></div>
<div id="musicControl" class="music-note hidden">
  <button id="musicBtn" class="bg-pink-500 text-white p-3 rounded-full shadow-lg">üéµ</button>
</div>

<!-- COVER (sama seperti index.html) -->
<section id="cover" class="min-h-screen flex flex-col items-center justify-center p-4 text-center">
  <div class="animate-fade-in">
    <h2 class="font-dancing text-3xl text-pink-600 mb-4">Undangan Pernikahan</h2>
    <h1 class="font-dancing text-6xl md:text-8xl text-pink-600 mb-4">Tiyah & Ubed</h1>
    <h2 class="text-gray-700 text-2xl mb-6 font-serif tracking-wider italic relative inline-block">
      <span class="before:absolute before:-left-8 before:top-1/2 before:w-6 before:h-px before:bg-gray-400 
                    after:absolute after:-right-8 after:top-1/2 after:w-6 after:h-px after:bg-gray-400">
        13 ‚Ä¢ 12 ‚Ä¢ 25
      </span>
    </h2>

    <div class="bg-white/80 rounded-2xl p-6 shadow-xl max-w-md mx-auto mb-6">
      <p class="text-gray-700 mb-3">Kepada Yth. Bapak/Ibu/Saudara/i</p>
      <div id="recipientName" class="text-lg font-semibold text-pink-600 mb-2">(Nama Tamu)</div>
      <p class="text-sm italic text-gray-600" style="font-size: 0.7rem;">Mohon maaf apabila ada kesalahan dalam penulisan nama & gelar</p>
    </div>

    <button onclick="openInvitation()" 
      style="background: linear-gradient(90deg, #ec4899, #a855f7, #ec4899); background-size: 200% 200%; color: white; padding: 12px 40px; border-radius: 9999px; font-size: 1.5rem; box-shadow: 0 4px 10px rgba(0,0,0,0.25); transition: transform 0.3s ease; cursor: pointer;"
      onmouseover="this.style.transform='scale(1.08)'" onmouseout="this.style.transform='scale(1)'" >
      üíå Buka Undangan
    </button>
  </div>
</section>

<div id="invitation" class="hidden">
  <!-- Header Mempelai -->
  <header class="text-center py-10">
    <p class="text-gray-500 text-base italic font-serif leading-snug tracking-normal px-6 md:px-16">
      ‚ÄúSegala puji bagi Allah yang telah menciptakan makhluk-Nya berpasang-pasangan‚Äù
    </p>
  </header>

  <!-- Mempelai Section -->
  <section class="mempelai-bg py-16 px-4 text-white text-center">
    <div class="mempelai-content max-w-md mx-auto">
      <h2 class="font-dancing text-4xl mb-10">Menikah</h2>

      <div class="bg-white/70 text-gray-800 rounded-2xl p-6 shadow-lg mb-4">
        <h3 class="font-dancing text-3xl font-extrabold text-pink-600 mb-1">Wafrotul Atiyah, S.H.</h3>
        <p class="text-sm">Putri pertama dari <br> Bapak Fatkur Rohman & Ibu Mukholifah<br> KALITENGAH - LAMONGAN</p>
      </div>

      <h2 class="font-dancing text-3xl text-white italic mb-4 mt-3 tracking-wide drop-shadow-lg">dengan</h2>

      <div class="bg-white/70 text-gray-800 rounded-2xl p-6 shadow-lg">
        <h3 class="font-dancing text-3xl font-extrabold text-pink-600 mb-1">Salim Ubaidillah, S.Kom.,Gr.</h3>
        <p class="text-sm">Putra pertama dari<br> Bapak Muslihan (Purn TNI-AD) & Ibu Sri Fadilah <br> BABAT - LAMONGAN</p>
      </div>
    </div>
  </section>

  <!-- Detail Acara + Map -->
  <section class="py-12 px-4 bg-white/60 text-gray-800">
    <h3 class="font-dancing text-3xl text-pink-600 mb-2 text-center">Dengan penuh kebahagiaan</h3>
    <p class="text-gray-700 text-base font-serif italic leading-snug text-center px-8 md:px-20">
      Kami mengundang Bapak/Ibu/Saudara/i untuk menghadiri acara kami Insya Allah pada,<br><br>
    </p>

    <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
      <div class="bg-white rounded-2xl p-6 shadow text-center">
        <h3 class="font-dancing text-5xl text-pink-600 mb-2"><b>Sabtu</b></h3>
        <h3 class="font-dancing text-4xl text-pink-600 mb-2">13 Desember 2025</h3>
      </div>
      <div class="bg-white rounded-2xl p-6 shadow text-center">
        <h3 class="font-dancing text-2xl text-pink-600 mb-2">Akad Nikah</h3>
        <p>08.00 WIB</p>
        <h3 class="font-dancing text-2xl text-pink-600 mb-2 mt-4">Resepsi</h3>
        <p>10.00 WIB</p>
        <h3 class="font-dancing text-2xl text-pink-600 mb-2 mt-4">Kediaman Mempelai Wanita</h3>
        <small>Dusun Dondoman RT 03 RW 01 Desa Bojoasri,<br>Kec Kalitengah KAB.LAMONGAN</small>
      </div>
    </div>

    <div class="mt-8 max-w-4xl mx-auto text-center">
      <iframe src="https://www.google.com/maps?q=-7.044735,112.409668&hl=es;z=15&output=embed" width="100%" height="300" style="border:0; border-radius:12px;" allowfullscreen="" loading="lazy"></iframe>
      <a href="https://www.google.com/maps?q=-7.044735,112.409668" target="_blank" class="text-pink-600 font-semibold mt-2 inline-block">Buka di Google Maps</a>
    </div>
  </section>

  <!-- Countdown -->
  <section class="py-10 text-center">
    <h2 class="font-dancing text-4xl text-pink-600 mb-6">Menuju Hari Bahagia</h2>
    <div id="countdown" class="grid grid-cols-4 gap-3 max-w-xs mx-auto"></div>
  </section>

  <!-- Ucapan & Kehadiran (terhubung ke Firebase) -->
  <section class="py-12 px-4 bg-white/60">
    <div class="max-w-4xl mx-auto">
      <h2 class="font-dancing text-4xl text-center text-pink-600 mb-8">Ucapan & Kehadiran</h2>

      <!-- FORM KOMENTAR (sama id seperti rindex2) -->
      <form id="commentForm" class="bg-white/80 p-6 rounded-2xl shadow mb-6">
        <input id="userName" placeholder="Nama Anda" class="w-full mb-3 px-4 py-3 border rounded-lg focus:ring-2 focus:ring-pink-500" />
        <div class="mb-3">
          <label class="mr-4"><input type="radio" name="attendance" value="insyaAllah Hadir" checked> ‚úîÔ∏è insyaAllah Hadir</label><br>
          <label><input type="radio" name="attendance" value="Maaf belum bisa hadir"> ‚ùå Maaf belum bisa hadir</label>
        </div>
        <textarea id="userMessage" rows="3" placeholder="Tuliskan ucapan & doa..." class="w-full mb-3 px-4 py-3 border rounded-lg focus:ring-2 focus:ring-pink-500"></textarea>
        <button class="w-full bg-gradient-to-r from-pink-500 to-purple-500 text-white py-3 rounded-lg shadow hover:scale-105 transition">Kirim</button>
      </form>

      <div id="commentList" class="space-y-3 max-h-96 overflow-y-auto text-sm text-gray-800 px-2 md:px-8">
        <p class="text-gray-500 text-center">Memuat ucapan...</p>
      </div>
    </div>
  </section>

  <!-- Amplop Digital (sama seperti index.html) -->
  <section class="py-12 px-4 bg-white text-center">
    <h2 class="font-dancing text-4xl text-pink-600 mb-6">Amplop Digital</h2>
    <button id="toggleAmplop" onclick="toggleAmplop()"
      class="bg-gradient-to-r from-pink-500 to-purple-500 text-white px-6 py-3 rounded-full shadow hover:scale-105 transition font-medium">
      üíå Buka Amplop Digital
    </button>

    <div id="amplopContent" class="max-w-md mx-auto mt-6 space-y-6 opacity-0 max-h-0 overflow-hidden transition-all duration-700 ease-in-out">
      <!-- Bank/E-wallet/QRIS content (potongan dari index) -->
      <div class="bg-pink-50 p-5 rounded-xl shadow">
        <h3 class="text-pink-600 font-semibold mb-4 text-lg text-center">Transfer Bank</h3>
        <div class="mb-6">
          <div class="flex items-center justify-between border-b border-pink-200 pb-1 mb-2">
            <div class="flex items-center gap-2">
              <svg width="28" height="28" viewBox="0 0 50 50"><rect width="50" height="50" rx="8" fill="#0060AF"/><text x="25" y="32" fill="white" font-size="20" font-family="Arial" text-anchor="middle">BCA</text></svg>
              <p class="text-gray-700 font-medium">BANK BCA</p>
            </div>
          </div>
          <div class="flex items-center justify-between border-b border-pink-200 pb-1 mb-2">
            <div>
              <p class="text-gray-700">No. Rekening:</p>
              <b id="rekBCA" class="text-gray-900">5610541790</b>
            </div>
            <button onclick="copyRekening('rekBCA', this)" class="ml-2 px-3 py-1 bg-pink-500 text-white rounded text-sm flex items-center gap-1 hover:bg-pink-600 transition transform hover:scale-105">
              <span class="copyIcon">üìã</span>
              <span class="copyText">Salin</span>
            </button>
          </div>
          <small class="text-gray-700 text-left block">Atas nama: <b class="text-gray-900">Mochamad Salim Ubaidillah</b></small>
        </div>

        <!-- BNI, BRImo etc omitted for brevity (you can copy same pattern from index file) -->
      </div>

      <!-- E-Wallet & QRIS sections copyable from index.html -->
      <div class="bg-pink-50 p-5 rounded-xl shadow text-center">
        <h3 class="text-pink-600 font-semibold mb-4 text-lg">QRIS</h3>
        <img src="qris.png" alt="QRIS" class="mx-auto w-40 rounded-lg shadow">
        <p class="text-gray-700 mt-3 text-sm">Scan QR di atas untuk mengirim melalui aplikasi pilihanmu ü§≥</p>
      </div>
    </div>
  </section>

  <footer class="py-10 text-center bg-white/60">
    <h3 class="font-dancing text-3xl text-pink-600 mb-2">Terima Kasih</h3>
    <p class="text-gray-600 text-sm italic leading-snug px-6 md:px-20 text-center">Merupakan suatu kebahagiaan dan kehormatan bagi kami apabila Bapak/Ibu/Saudara/i berkenan hadir dan memberikan doa restu di hari bahagia kami.</p>
    <p class="text-xs text-gray-500 mt-4">Tiyah & Ubed ‚Ä¢ 2025</p>
  </footer>
</div>

<audio id="bgMusic" src="musik.mp3" preload="auto" loop></audio>

<!-- Toast container -->
<div id="toastContainer"></div>

<!-- FIREBASE SDK (compat, sama seperti rindex2) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// ---------- UI interactions (countdown, petals, music) largely from index.html ----------
let isPlaying=false;
function openInvitation(){
  document.getElementById("cover").style.display="none";
  document.getElementById("invitation").classList.remove("hidden");
  document.getElementById("musicControl").classList.remove("hidden");
  startCountdown();
  createPetals();
  const music=document.getElementById("bgMusic"), btn=document.getElementById("musicBtn");
  music.play().then(()=>{isPlaying=true; if(btn) btn.textContent="üéµ";}).catch(()=>{if(btn) btn.textContent="üîá";});
}
document.addEventListener('click', function(e){
  if(e.target && e.target.id === 'musicBtn'){
    const m=document.getElementById("bgMusic"), b=document.getElementById("musicBtn");
    if(isPlaying){m.pause();b.textContent="üîá";}else{m.play();b.textContent="üéµ";} isPlaying=!isPlaying;
  }
});

function startCountdown(){
  const d=new Date("2025-12-13T09:00:00");
  setInterval(()=>{
    const now=new Date().getTime(), dist=d-now;
    if(dist<0){document.getElementById("countdown").innerHTML='<div class="col-span-4 text-pink-600 font-dancing text-xl">Hari Bahagia Telah Tiba! üíï</div>'; return;}
    const days=Math.floor(dist/(1000*60*60*24)),
          h=Math.floor((dist%(1000*60*60*24))/(1000*60*60)),
          m=Math.floor((dist%(1000*60*60))/(1000*60)),
          s=Math.floor((dist%(1000*60))/1000);
    document.getElementById("countdown").innerHTML=[["Hari",days],["Jam",h],["Menit",m],["Detik",s]].map(([l,v])=>`<div class='bg-white/80 rounded-lg p-3 shadow'><div class='text-2xl font-bold text-pink-600'>${v}</div><div>${l}</div></div>`).join("");
  },1000);
}
function createPetals(){
  const p=document.getElementById("petals");
  setInterval(()=>{
    const el=document.createElement("div");
    el.className="petal";
    el.style.left=Math.random()*100+"%";
    el.style.animationDelay=Math.random()*2+"s";
    el.style.animationDuration=(Math.random()*3+5)+"s";
    p.appendChild(el);
    setTimeout(()=>el.remove(),8000);
  },300);
}
function copyRekening(id, btn) {
  const rekening = document.getElementById(id).innerText;
  const icon = btn.querySelector('.copyIcon');
  const text = btn.querySelector('.copyText');
  navigator.clipboard.writeText(rekening).then(() => {
    if (icon && text) {
      icon.textContent = "‚úÖ";
      text.textContent = "Tersalin";
      btn.classList.add("scale-110");
      setTimeout(() => { icon.textContent = "üìã"; text.textContent = "Salin"; btn.classList.remove("scale-110"); }, 2000);
    } else {
      btn.textContent = "‚úÖ";
      btn.classList.add("scale-110");
      setTimeout(()=>{ btn.textContent = "üìã"; btn.classList.remove("scale-110"); },2000);
    }
  }).catch(()=>{ showToast("Gagal menyalin, silakan salin manual.","bg-red-500"); });
}

function toggleAmplop() {
  const content = document.getElementById("amplopContent");
  const btn = document.getElementById("toggleAmplop");
  const isOpen = content.classList.contains("open");
  if (isOpen) {
    content.classList.remove("open");
    content.style.maxHeight = "0px";
    content.style.opacity = "0";
    btn.innerHTML = "üíå Buka Amplop Digital";
  } else {
    content.classList.add("open");
    content.style.maxHeight = content.scrollHeight + "px";
    content.style.opacity = "1";
    btn.innerHTML = "‚ùå Tutup Amplop Digital";
  }
}

// ---------- Toast ----------
function showToast(msg, color="bg-pink-500"){
  const toast = document.createElement("div");
  toast.className = `toast ${color}`;
  toast.textContent = msg;
  document.getElementById("toastContainer").appendChild(toast);
  setTimeout(()=>toast.remove(),3000);
}

// ---------- Firebase config & komentar logic (diadaptasi dari rindex2) ----------
const firebaseConfig = {
  apiKey: "AIzaSyD4l3qJ-y7i4zL5DdqmbvO-DUMMY-KEY",
  authDomain: "komentardb.firebaseapp.com",
  databaseURL: "https://komentardb-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "komentardb",
  storageBucket: "komentardb.appspot.com",
  messagingSenderId: "1234567890",
  appId: "1:1234567890:web:abcdef123456"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Submit komentar -> push ke Firebase
document.getElementById("commentForm").addEventListener("submit", e => {
  e.preventDefault();
  const nama = document.getElementById("userName").value.trim();
  const pesan = document.getElementById("userMessage").value.trim();
  const kehadiran = document.querySelector('input[name="attendance"]:checked').value;
  if (!nama || !pesan) return showToast("Isi nama dan ucapan dulu üíï","bg-red-500");

  db.ref("komentar").push({
    nama, pesan, kehadiran,
    waktu: new Date().toISOString(),
    likes: 0,
    replies: {}
  });
  showToast("Ucapan terkirim! üíñ","bg-green-500");
  e.target.reset();
});

// Like comment
function likeComment(id){
  const ref = db.ref("komentar/"+id+"/likes");
  ref.transaction(c => (c||0)+1);
  showToast("Kamu menyukai ucapan ini ‚ù§Ô∏è");
}

// Toggle edit comment UI
function toggleEditComment(id,oldMsg){
  const box=document.getElementById("comment_"+id);
  const existing=document.getElementById("editForm_"+id);
  if(existing){existing.remove();return;}
  const form=document.createElement("div");
  form.id="editForm_"+id;
  form.className="mt-2";
  form.innerHTML=`
    <textarea id="editMsg_${id}" class="w-full p-2 border rounded mb-2 text-sm">${oldMsg}</textarea>
    <div class="flex gap-2">
      <button onclick="saveEditComment('${id}')" class="bg-pink-500 text-white px-3 py-1 rounded text-sm">Simpan</button>
      <button onclick="cancelEditComment('${id}')" class="bg-gray-300 px-3 py-1 rounded text-sm">Batal Edit</button>
    </div>`;
  box.appendChild(form);
}
function saveEditComment(id){
  const newMsg=document.getElementById("editMsg_"+id).value.trim();
  if(!newMsg) return showToast("Isi tidak boleh kosong!","bg-red-500");
  db.ref("komentar/"+id+"/pesan").set(newMsg);
  cancelEditComment(id);
  showToast("Ucapan berhasil diedit ‚úèÔ∏è","bg-green-500");
}
function cancelEditComment(id){
  const form=document.getElementById("editForm_"+id);
  if(form) form.remove();
}
function deleteComment(id){
  if(confirm("Hapus ucapan ini?")){
    db.ref("komentar/"+id).remove();
    showToast("Ucapan dihapus üóëÔ∏è","bg-gray-500");
  }
}

// Reply handling
function toggleReplyForm(id){
  const formId="replyForm_"+id;
  const existing=document.getElementById(formId);
  if(existing){existing.remove();return;}
  const container=document.getElementById("comment_"+id);
  const form=document.createElement("div");
  form.id=formId;
  form.className="reply-form mt-2";
  form.innerHTML=`
    <input id="replyName_${id}" placeholder="Nama Anda" class="w-full mb-2 px-3 py-2 border rounded-lg text-sm"/>
    <textarea id="replyText_${id}" rows="2" placeholder="Tulis balasan..." class="w-full mb-2 px-3 py-2 border rounded-lg text-sm"></textarea>
    <div class="flex gap-2">
      <button onclick="sendReply('${id}')" class="bg-pink-500 text-white px-3 py-1 rounded-lg text-sm">Kirim Balasan</button>
      <button onclick="cancelReply('${id}')" class="bg-gray-300 px-3 py-1 rounded-lg text-sm">Batal</button>
    </div>`;
  container.appendChild(form);
}
function cancelReply(commentId){
  const form=document.getElementById("replyForm_"+commentId);
  if(form) form.remove();
}
function sendReply(commentId){
  const name=document.getElementById("replyName_"+commentId).value.trim();
  const text=document.getElementById("replyText_"+commentId).value.trim();
  if(!name||!text) return showToast("Isi nama dan balasan dulu üíï","bg-red-500");
  db.ref("komentar/"+commentId+"/replies").push({
    nama:name,pesan:text,waktu:new Date().toISOString(),likes:0
  });
  cancelReply(commentId);
  showToast("Balasan dikirim üíå","bg-green-500");
}
function likeReply(commentId,replyId){
  const ref=db.ref(`komentar/${commentId}/replies/${replyId}/likes`);
  ref.transaction(c=>(c||0)+1);
  showToast("Kamu menyukai balasan ‚ù§Ô∏è");
}
function toggleEditReply(commentId,replyId,oldMsg){
  const box=document.getElementById(`reply_${commentId}_${replyId}`);
  const existing=document.getElementById(`editReplyForm_${commentId}_${replyId}`);
  if(existing){existing.remove();return;}
  const form=document.createElement("div");
  form.id=`editReplyForm_${commentId}_${replyId}`;
  form.className="mt-2";
  form.innerHTML=`
    <textarea id="editReplyText_${commentId}_${replyId}" class="w-full p-2 border rounded mb-2 text-sm">${oldMsg}</textarea>
    <div class="flex gap-2">
      <button onclick="saveEditReply('${commentId}','${replyId}')" class="bg-pink-500 text-white px-3 py-1 rounded text-sm">Simpan</button>
      <button onclick="cancelEditReply('${commentId}','${replyId}')" class="bg-gray-300 px-3 py-1 rounded text-sm">Batal Edit</button>
    </div>`;
  box.appendChild(form);
}
function saveEditReply(commentId,replyId){
  const newMsg=document.getElementById(`editReplyText_${commentId}_${replyId}`).value.trim();
  if(!newMsg) return showToast("Isi tidak boleh kosong!","bg-red-500");
  db.ref(`komentar/${commentId}/replies/${replyId}/pesan`).set(newMsg);
  cancelEditReply(commentId,replyId);
  showToast("Balasan berhasil diedit ‚úèÔ∏è","bg-green-500");
}
function cancelEditReply(commentId,replyId){
  const form=document.getElementById(`editReplyForm_${commentId}_${replyId}`);
  if(form) form.remove();
}
function deleteReply(commentId,replyId){
  if(confirm("Hapus balasan ini?")){
    db.ref(`komentar/${commentId}/replies/${replyId}`).remove();
    showToast("Balasan dihapus üóëÔ∏è","bg-gray-500");
  }
}

// Rendering comments from Firebase
db.ref("komentar").on("value", snapshot=>{
  const data = snapshot.val() || {};
  const keys = Object.keys(data).reverse();
  const list = document.getElementById("commentList");
  if(!keys.length) return list.innerHTML = '<p class="text-gray-500 text-center">Belum ada ucapan üòç</p>';
  list.innerHTML = keys.map(id=>{
    const c = data[id] || {};
    const replies = c.replies ? Object.entries(c.replies) : [];
    const replyHtml = replies.map(([rid, r]) => `
      <div id="reply_${id}_${rid}" class="reply-box">
        <div class="flex justify-between items-start">
          <div>
            <div class="text-sm text-pink-700 font-semibold">${escapeHtml(r.nama)}</div>
            <div class="text-gray-700 text-sm">${escapeHtml(r.pesan)}</div>
            <div class="text-gray-400 text-xs">${new Date(r.waktu).toLocaleString('id-ID')}</div>
          </div>
          <div class="text-xs text-gray-500 space-x-1">
            <button onclick="likeReply('${id}','${rid}')" class="hover:text-pink-600">‚ù§Ô∏è ${r.likes||0}</button>
            <button onclick="toggleEditReply('${id}','${rid}','${(r.pesan||'').replace(/'/g,\"\\\\'\")}')" class="hover:text-blue-600">‚úèÔ∏è</button>
            <button onclick="deleteReply('${id}','${rid}')" class="hover:text-red-600">üóëÔ∏è</button>
          </div>
        </div>
      </div>`).join("");
    return `
      <div id="comment_${id}" class="comment-bubble text-left">
        <div class="flex justify-between items-start">
          <div class="comment-author">
            ${escapeHtml(c.nama || 'Anon')}
            ${ (c.kehadiran||'').includes('Hadir') ? '<span class="text-green-600 font-semibold ml-1">‚úÖ</span>' : '<span class="text-red-600 font-semibold ml-1">‚ùå</span>'}
          </div>
          <div class="text-xs space-x-2 text-gray-500">
            <button onclick="likeComment('${id}')" class="hover:text-pink-600">‚ù§Ô∏è ${c.likes||0}</button>
            <button onclick="toggleReplyForm('${id}')" class="hover:text-pink-600">üí¨</button>
            <button onclick="toggleEditComment('${id}','${(c.pesan||'').replace(/'/g,\"\\\\'\")}')" class="hover:text-blue-600">‚úèÔ∏è</button>
            <button onclick="deleteComment('${id}')" class="hover:text-red-600">üóëÔ∏è</button>
          </div>
        </div>
        <div class="comment-msg">${escapeHtml(c.pesan||'')}</div>
        <div class="comment-time">${new Date(c.waktu).toLocaleString('id-ID')}</div>
        ${replyHtml}
      </div>`;
  }).join('');
});

// basic escape to avoid simple HTML injection
function escapeHtml(unsafe) {
  if(!unsafe && unsafe !== 0) return '';
  return String(unsafe)
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}

// initialize view recipient if URL param `to` present
window.addEventListener("DOMContentLoaded",()=>{
  const p=new URLSearchParams(window.location.search).get("to");
  if(p) document.getElementById("recipientName").textContent=decodeURIComponent(p);
});
</script>
</body>
</html>
